"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getServerAddress = exports.closeServer = exports.getHeaderValueHead = void 0;
const pipeable_1 = require("fp-ts/lib/pipeable");
const Option_1 = require("fp-ts/lib/Option");
const array_util_1 = require("./array.util");
exports.getHeaderValueHead = (key) => (req) => {
    const header = req.headers[key.toLowerCase()];
    return Array.isArray(header)
        ? pipeable_1.pipe(array_util_1.getHead(header), Option_1.toUndefined)
        : header;
};
exports.closeServer = (server) => () => new Promise((res, rej) => server.close(err => err ? rej(err) : res()));
exports.getServerAddress = (server) => {
    const serverAddressInfo = server.address();
    const host = serverAddressInfo.address === '::' ? '127.0.0.1' : serverAddressInfo.address;
    const port = serverAddressInfo.port;
    return { host, port };
};
