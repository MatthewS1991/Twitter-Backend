"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.decorateMiddleware = exports.decorateEffect = exports.isRouteCombinerConfig = exports.isRouteEffectGroup = void 0;
const rxjs_1 = require("rxjs");
const pipe_1 = require("rxjs/internal/util/pipe");
const operators_1 = require("rxjs/operators");
exports.isRouteEffectGroup = (item) => Array.isArray(item.effects) &&
    Array.isArray(item.middlewares);
exports.isRouteCombinerConfig = (item) => Array.isArray(item.effects);
exports.decorateEffect = (stream, errorSubject) => {
    stream.pipe = (...operations) => {
        return rxjs_1.pipe(operators_1.mergeMap((request) => pipe_1.pipeFromArray([
            ...operations,
            operators_1.map((res) => (Object.assign(Object.assign({}, res), { request }))),
            operators_1.catchError((error) => {
                errorSubject.next({ error, req: request });
                return rxjs_1.EMPTY;
            }),
        ])(rxjs_1.of(request))))(stream);
    };
    return stream;
};
exports.decorateMiddleware = (stream, errorSubject) => {
    stream.pipe = (...operations) => {
        return rxjs_1.pipe(operators_1.mergeMap((request) => pipe_1.pipeFromArray([
            ...operations,
            operators_1.catchError((error) => {
                errorSubject.next({ error, req: request });
                return rxjs_1.EMPTY;
            }),
        ])(rxjs_1.of(request))))(stream);
    };
    return stream;
};
