"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.switchToProtocol = void 0;
const rxjs_1 = require("rxjs");
const operators_1 = require("rxjs/operators");
const http_interface_1 = require("../../http/http.interface");
exports.switchToProtocol = (protocol) => (source$) => source$.pipe(operators_1.mergeMap(({ headers }) => rxjs_1.iif(() => (headers.upgrade !== protocol || headers.connection !== 'upgrade'), rxjs_1.of({
    status: http_interface_1.HttpStatus.UPGRADE_REQUIRED,
    headers: { 'Upgrade': protocol },
}), rxjs_1.of({
    status: http_interface_1.HttpStatus.SWITCHING_PROTOCOLS,
}))));
